---
title: "BSG HW4"
author: "Sten-Oliver Salumaa, Denys Kovalenko"
date: "13 December 2017"
output: html_document
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Task1
#### Myoglobin is an oxygen-binding protein found in muscle tissue. The protein is encoded by the MB gene, which resides on the long arm of chromosome 22. The file MB.rda contains genotype information of unrelated individuals for a set of SNPs in the MB gene. The file contains genotype information in object Y. Load this data into the R environment.

```{r echo=FALSE, warning=FALSE}
load("MB.rda")
```


## Task2
####  (1p) How many individuals and how many SNPs are there in the database? What percentage of the data is missing? 

```{r echo=FALSE, warning=FALSE}
print("Individual count:")
nrow(Y)
print("SNP count:")
ncol(Y)

total <- ncol(Y)*nrow(Y)
nas <- length(Y[is.na(Y)])
print("Percentage of data missing:")
nas/total*100
```


## Task3
#### Assuming all SNPs are bi-allelic, how many haplotypes can theoretically be found for this data set?

```{r echo=FALSE, warning=FALSE}
# not sure but looks like 2**(num of SNPs)
print("Theoretical number of haplotypes:")
2**ncol(Y)
```

## Task4
#### Estimate haplotype frequencies using the haplo.stats package (set the minimum posterior probability to 0.001). How many haplotypes do you find? List the haplotypes and their estimated probabilities. Which haplotype is the most common?

```{r echo=FALSE, warning=FALSE}
library(haplo.stats)

# Remove all SNPs with one or more missing observations.
nmis <- function(x) {
  y <- sum(is.na(x))
}

# get the nmis of SNPs
mispersnp <- apply(Y,1,nmis)
#mispersnp

#dim(Y)
Y2 <- Y[mispersnp==0,]
#dim(Y2)

Geno2 <- cbind(substr(Y[,1],1,1),substr(Y[,1],2,2))
for(i in 2:ncol(Y)) {
  Geno2 <- cbind(Geno2,substr(Y[,i],1,1),substr(Y[,i],2,2))
}


snpnames <- paste("snp", 1:28,sep="")

out <-  haplo.em(Geno2,
                 locus.label=snpnames,
                 control=haplo.em.control(min.posterior=1e-3))



print("In total there are ")
nrow(out$haplotype)
print("haplotypes with")
paste(tail(out$haplotype,1))
print("being the most popular haplotype with probability of")
tail(out$hap.prob,1)

```


## Task5
####  Is the haplotypic constitution of any of the individuals in the database ambiguous or uncertain? If so, for which individuals? What is, in this case, the most likely haplotypic constitution of any possibly uncertain individuals?

```{r echo=FALSE, warning=FALSE}



```

```{r echo=FALSE, warning=FALSE}


```


```{r echo=FALSE, warning=FALSE}


```


```{r echo=FALSE, warning=FALSE}


```