---
title: "BSG HW4"
author: "Sten-Oliver Salumaa, Denys Kovalenko"
date: "13 December 2017"
output: html_document
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Task1
#### Myoglobin is an oxygen-binding protein found in muscle tissue. The protein is encoded by the MB gene, which resides on the long arm of chromosome 22. The file MB.rda contains genotype information of unrelated individuals for a set of SNPs in the MB gene. The file contains genotype information in object Y. Load this data into the R environment.

```{r echo=FALSE, warning=FALSE}
load("MB.rda")
```


## Task2
####  (1p) How many individuals and how many SNPs are there in the database? What percentage of the data is missing? 

```{r echo=FALSE, warning=FALSE}
print("Individual count:")
nrow(Y)
print("SNP count:")
ncol(Y)

total <- ncol(Y)*nrow(Y)
nas <- length(Y[is.na(Y)])
print("Percentage of data missing:")
nas/total*100
```


## Task3
#### Assuming all SNPs are bi-allelic, how many haplotypes can theoretically be found for this data set?

```{r echo=FALSE, warning=FALSE}
# not sure but looks like 2**(num of SNPs)
print("Theoretical number of haplotypes:")
2**ncol(Y)
```

## Task4
#### Estimate haplotype frequencies using the haplo.stats package (set the minimum posterior probability to 0.001). How many haplotypes do you find? List the haplotypes and their estimated probabilities. Which haplotype is the most common?

```{r echo=FALSE, warning=FALSE}
library(haplo.stats)

# Remove all SNPs with one or more missing observations.
#nmis <- function(x) {
#  y <- sum(is.na(x))
#}

# get the nmis of SNPs
#mispersnp <- apply(Y,1,nmis)
#mispersnp

#dim(Y)
#Y2 <- Y[mispersnp==0,]
#dim(Y2)

Geno2 <- cbind(substr(Y[,1],1,1),substr(Y[,1],2,2))
for(i in 2:ncol(Y)) {
  Geno2 <- cbind(Geno2,substr(Y[,i],1,1),substr(Y[,i],2,2))
}


snpnames <- paste("snp", 1:28,sep="")

out <-  haplo.em(Geno2,
                 locus.label=snpnames,
                 control=haplo.em.control(min.posterior=1e-3))



print("In total there are ")
nrow(out$haplotype)
print("haplotypes with")
paste(tail(out$haplotype,1))
print("being the most popular haplotype with probability of")
tail(out$hap.prob,1)

```


## Task5
####  Is the haplotypic constitution of any of the individuals in the database ambiguous or uncertain? If so, for which individuals? What is, in this case, the most likely haplotypic constitution of any possibly uncertain individuals?

```{r echo=FALSE, warning=FALSE}



```

```{r echo=FALSE, warning=FALSE}


```

## Task 6. (1p)
#### Suppose we would delete SNP rs5999890 from the database prior to haplotype estimation. Would this affect the results obtained? Justify your answer. Delete this SNP from the database and estimate again the haplotype frequencies. List the haplotypes and their estimated frequencies.

##It shouldn't affect results, cause SNP rs5999890 has only CC values, so it doesn't change possible haplotypes.
```{r echo=FALSE, warning=FALSE}
Y_cut <- Y[,-5]

Geno2_cut <- cbind(substr(Y_cut[,1],1,1),substr(Y_cut[,1],2,2))
for(i in 2:ncol(Y_cut)) {
  Geno2_cut <- cbind(Geno2_cut,substr(Y_cut[,i],1,1),substr(Y_cut[,i],2,2))
}


snpnames <- paste("snp", 1:27,sep="")

out_cut <-  haplo.em(Geno2_cut,
                 locus.label=snpnames,
                 control=haplo.em.control(min.posterior=1e-3))



print("In total there are ")
nrow(out_cut$haplotype)
print("haplotypes with")
paste(tail(out_cut$haplotype,1))
print("being the most popular haplotype with probability of")
tail(out_cut$hap.prob,1)

```
## and actually we got same results


## Task 7 (2p)
#### We could consider the newly created haplotypes as the alleles of a new locus. Which is, under the assumption of Hardy-Weinberg equilibrium, the most likely genotype at this new locus? What is the probability of this genotype? Which genotype is the second most likely? 

```{r echo=FALSE, warning=FALSE}

```

## Task 8 (1p)
#### 8. (1p) Simulate a set of independent markers using the the multinomial distribution (R function rmultinom) that mimicks the Myoglobin data in terms of sample size, number of SNPs and minor allele frequencies, assuming HardyWeinberg equilibrium (that is, simulate the markers with multinomial probabilities p2 , 2pq and q2, where p is the observed minor allele frequency) Create haplotypes on the basis of the simulated data. Do you find the same number of haplotypes? Can you explain the difference? 
```{r echo=FALSE, warning=FALSE}

```